import matplotlib
import matplotlib.pyplot as plt
import numpy as np
from mpl_toolkits.axes_grid1.inset_locator import inset_axes
from matplotlib.patches import ConnectionPatch

matplotlib.rcParams['font.family'] = 'Times New Roman'  # set the font
plt.rcParams['pdf.fonttype'] = 42
plt.rcParams['ps.fonttype'] = 42




# color_list = ['yellowgreen', 'steelblue', 'darkorange', 'dimgray']
# color_list1 =['#e600e6','#00cccb','dimgray','yellowgreen']
color_list1 = [ 'red', 'tab:green', 'darkorange', 'tab:blue']



def res_plot2(epoch, val_acces, label_list):

    matplotlib.rcParams['font.family'] = 'Times New Roman'
    matplotlib.rcParams.update({'font.size':8, 'font.family': 'serif'})
    plt.rcParams['pdf.fonttype'] = 42
    plt.rcParams['ps.fonttype'] = 42
    # matplotlib.rc('font', size=24)
    marker_list = ['', 'o', 'x', '>', 's', '^']
    epoches = np.arange(0, epoch, 1)
    # 画出训练结果
    plt.figure(figsize=(8, 5))
    # plt.plot(epoches, val_acces[0], 'k', label=label_list[0], linewidth=2)
    for index in range(0, len(val_acces)):
        plt.plot(epoches, val_acces[index],
                 label=label_list[index], linewidth=2.5, marker=marker_list[index],ms=8,color=color_list1[index])

    plt.xlabel('# of Global Rounds', fontdict={'weight': 'normal', 'size': 28})  # X轴标签
    plt.ylabel('Latency(s)', fontdict={'weight': 'normal', 'size': 28})  # Y轴标签


    plt.grid(c='#d2c9eb', linestyle='--', zorder=0)


    # cora x,y轴设置
    plt.xticks([0, 10, 20, 30, 40, 50])
    # plt.yticks([0.2, 0.4, 0.6, 0.8])

    # citeseer x，y轴设置
    # plt.yticks([0.35, 0.4, 0.45, 0.5, 0.55])

    # pubmed x，y轴设置
    plt.xlim(0, 50)
    # 添加这部分代码
    plt.ticklabel_format(style='sci', scilimits=(-1, 2), axis='y')
    ax=plt.gca()
    ax.get_yaxis().get_offset_text().set(va='bottom', ha='left')
    ax.yaxis.get_offset_text().set_fontsize(24)  # 设置1e6的大小与位置
    plt.xticks(fontsize=24)  # xtickets自定义的话，字体就设置大一点
    plt.yticks(fontsize=24)
    plt.legend(loc='best',fontsize=24)

    # #放大图
    # axins = inset_axes(ax, width="40%", height="30%", loc='center',
    #                    bbox_to_anchor=(0.3, 0.1, 1, 1),
    #                    bbox_transform=ax.transAxes)
    # # Reg
    # for index in range(0, len(val_acces)-1):
    #     axins.plot(epoches, val_acces[index],
    #              label=label_list[index], linewidth=2.5, marker=marker_list[index],ms=8,color=color_list1[index])
    # # 设置放大区间------------------------------
    # zone_left = 40
    # zone_right = 48
    #
    # # 坐标轴的扩展比例（根据实际数据调整）
    # x_ratio = 0  # x轴显示范围的扩展比例
    # y_ratio = 0.1  # y轴显示范围的扩展比例
    #
    # # X轴的显示范围
    # xlim0 = int(epoches[zone_left] - (epoches[zone_right] - epoches[zone_left]) * x_ratio)
    # xlim1 = int(epoches[zone_right] + (epoches[zone_right] - epoches[zone_left]) * x_ratio)
    # # Y轴的显示范围
    # y = np.hstack((val_acces[0][zone_left:zone_right],val_acces[2][zone_left:zone_right]))
    # ylim0 = np.min(y) - (np.max(y) - np.min(y)) * y_ratio+300
    # ylim1 = np.max(y) + (np.max(y) - np.min(y)) * y_ratio-5000
    #
    # # 调整子坐标系的显示范围
    # axins.set_xlim(xlim0, xlim1)
    # axins.set_ylim(ylim0, ylim1)
    #
    # # 原图中画方框
    # tx0 = xlim0
    # tx1 = xlim1
    # ty0 = ylim0
    # ty1 = ylim1
    # sx = [tx0, tx1, tx1, tx0, tx0]
    # sy = [ty0, ty0, ty1, ty1, ty0]
    # ax.plot(sx, sy, "black")
    #
    # # 画两条线
    # xy = (xlim0, ylim0)
    # xy2 = (xlim0, ylim1)
    # con = ConnectionPatch(xyA=xy2, xyB=xy, coordsA="data", coordsB="data",
    #                       axesA=axins, axesB=ax)
    # axins.add_artist(con)
    #
    # xy = (xlim1, ylim1)
    # xy2 = (xlim1, ylim1)
    # con = ConnectionPatch(xyA=xy2, xyB=xy, coordsA="data", coordsB="data",
    #                       axesA=axins, axesB=ax)
    # axins.add_artist(con)
    # axins.tick_params(axis='x', labelsize=14 )
    # axins.tick_params(axis='y', labelsize=14)
    plt.savefig('result/'+ model_name + '_time.pdf', format='pdf', bbox_inches='tight')
    plt.show()


model_name = 'CNN'  # "Reg", "CNN", "SVM"

if __name__ == '__main__':
    val_acces = []
    # cora的数据
    # '''
    label_list = ['ASFL', 'Oort', 'SAFA', 'FedCS']
    # Time Reg
    SAFA_Reg_T_3 = [141.41010725463366, 293.9522925370196, 438.5564357314299, 589.41878924275, 710.5065884460322,
                    863.6327737284181, 985.0165729317004, 1138.4547582140863, 1262.166679824713, 1417.925785562224,
                    1542.6298436155935, 1727.5040733252927, 1851.7599949359194, 2036.9062246456185, 2182.2534372776336,
                    2339.9191871606977, 2484.6071488214616, 2644.708186002054, 2791.6563291964644, 2950.9799443074985,
                    3099.222988710579, 3258.8426038216135, 3407.349648224694, 3567.2412633357285, 3716.0523077388093,
                    3877.321344919402, 4069.644830827448, 4233.3567758219115, 4362.046117650925, 4556.155014027291,
                    4682.994935637918, 4845.04797281851, 4971.479899933092, 5164.771385841139, 5291.491312955721,
                    5459.741282332092, 5588.853764166808, 5758.550131664142, 5887.918613498859, 6059.0955868399615,
                    6186.679513954544, 6356.959881451879, 6484.167814006418, 6657.164027657598, 6810.839992515804,
                    6923.527206509507, 7094.527574006841, 7204.729135042694, 7374.835104419066, 7485.717049823913]
    Oort_Reg_T_3 = [82.84108693525691, 299.26274451819, 369.4870844294703, 440.2769966454505, 544.1556195741177,
                    620.9344835665511, 725.0193021995165, 860.5986681959893, 1077.3003257789223, 1181.5051444118878,
                    1252.0494843231681, 1522.4373030930985, 1739.100547977619, 1843.3391709062862, 1947.8710866414376,
                    2083.54041951314, 2188.2803434408156, 2271.4180241955646, 2343.3726104064253, 2479.4319764028983,
                    2551.276701212582, 2656.3455542550305, 2926.673922420626, 3144.175772188056, 3280.2051050597584,
                    3385.433958102207, 3454.9530884052274, 3672.6149381726573, 3777.5797568056228, 3860.444652254741,
                    4078.4284977398615, 4214.284305588321, 4297.643284532875, 4567.919187417273, 4639.853523888581,
                    4722.958419337699, 4828.117042266365, 4900.171378737674, 5035.862178464736, 5107.142106186899,
                    5243.134360427203, 5320.437571330071, 5397.780782232938, 5503.09410129974, 5569.985307478205,
                    5643.404634854446, 6045.9335405825805, 6151.532163511248, 6224.878276574173, 6361.230530814477]
    ASFL_Reg_T_3 = [1.84E+02, 2.77E+02, 3.11E+02, 3.11E+02, 3.11E+02, 3.28E+02, 3.28E+02, 3.28E+02, 3.43E+02, 3.43E+02,
                    3.60E+02, 3.60E+02, 3.60E+02, 3.60E+02, 3.61E+02, 3.61E+02, 3.61E+02, 3.61E+02, 3.61E+02, 3.78E+02,
                    3.78E+02, 3.96E+02, 4.11E+02, 4.11E+02, 4.28E+02, 4.46E+02, 4.63E+02, 4.63E+02, 4.81E+02, 4.81E+02,
                    4.81E+02, 4.81E+02, 4.82E+02, 4.82E+02, 5.21E+02, 5.45E+02, 5.69E+02, 5.93E+02, 5.93E+02, 5.93E+02,
                    5.93E+02, 5.93E+02, 5.94E+02, 5.94E+02, 5.94E+02, 5.94E+02, 5.94E+02, 5.94E+02, 5.94E+02, 6.44E+02]
    FedCS_Reg_T_3 = [225.4679852797906, 450.9839705595812, 640.9965221056691, 866.8453058699495, 1092.7420896342298,
                     1581.1918747822579, 2070.1032248599795, 2296.6246045632242, 2359.2297547714516, 2549.0552755284602,
                     2739.1016870185254, 2891.2691835305486, 3380.887469511077, 3463.667356837327, 3545.293321086654,
                     4035.480019256301, 4225.9887682638, 4416.371179753865, 4906.701877923512, 5397.5105726531865,
                     5889.244460365317, 6041.891956877339, 6533.280343485717, 6760.3282472882565, 6950.873768045265,
                     7141.814517052764, 7369.247896756009, 7486.230816573195, 7713.760196276439, 7830.839116093624,
                     8058.223019896164, 8549.177718065812, 8776.181703345603, 9267.662398075277, 9494.52787277864,
                     9986.104567508315, 10140.127715738145, 10220.017513843615, 10411.40792533368, 10903.176620063356,
                     11130.33009476672, 11247.84733043135, 11320.002536943746, 11811.108822924274, 12301.844173001997,
                     12793.046458982526, 13285.1511537122, 13476.80067446921, 13969.001369198886, 14160.746889955895]
    Reg_T=[ASFL_Reg_T_3,SAFA_Reg_T_3,Oort_Reg_T_3,FedCS_Reg_T_3]
    # Time CNN
    SAFA_CNN_T_3 = [183.64256106118378, 440.57042408664046, 624.6243173678669, 879.5059663967937, 1084.5158012084387,
                    1338.6336585358897, 1566.4616420786024, 1818.7988874897894, 2064.3019818620146, 2317.0285831276483,
                    2527.01356148358, 2781.1721627492134, 2992.90131588632, 3248.5719171519536, 3498.5150115241786,
                    3757.7661221633357, 4008.2262693198886, 4271.040126647339, 4496.763863649539, 4758.870974288696,
                    4995.634351987639, 5258.107597398825, 5508.465686506046, 5770.228538542492, 6023.671445148004,
                    6287.886046413638, 6543.696336776557, 6808.331188813002, 7038.550083820122, 7307.729194459279,
                    7539.868831095892, 7810.4879417350485, 8073.263036107274, 8345.346146746431, 8578.84294074345,
                    8854.23384015687, 9083.237599878592, 9358.18471051775, 9608.826027350015, 9889.57167637894,
                    10169.3794001706, 10450.434840693186, 10708.724795561, 10990.08265288845, 11251.078451525793,
                    11457.963654356909, 11741.49751168436, 11949.790714515475, 12236.976363544401, 12447.790988445075]
    Oort_CNN_T_3 = [126.43111058051306, 243.0911855831423, 368.53134362567727, 503.2347188074779, 654.5430506473356,
                    779.4112038179853, 917.8796055574728, 1064.6210904754118, 1227.82085915296, 1381.285610783464,
                    1555.6779055524248, 1730.2635565912894, 1883.5578308938332, 2064.9703022247213, 2238.5447781481134,
                    2529.9072122995576, 2860.450418238026, 3194.7396636218095, 3656.9998223601483, 3787.0239337534304,
                    4249.364092491769, 4610.688902340869, 5006.177803911966, 5401.706705483063, 5537.58228450514,
                    6304.503194873214, 7082.645542859628, 7246.428025432861, 7397.421755891386, 7490.615058264848,
                    8447.949376446168, 8573.718817970588, 8710.934458196338, 8865.72216866731, 9013.24779122042,
                    9223.133538240483, 9342.855488036352, 9506.187381440535, 9645.585643123999, 11605.615071883774,
                    11822.066628425244, 11976.992211788705, 12159.17648436183, 12310.770214820353, 12486.174441367943,
                    12655.92434233924, 12820.822899545716, 12935.272706374215, 13049.848976524181, 13188.801326859124]
    ASFL_CNN_T_3 = [5.43E+02, 8.17E+02, 9.69E+02, 1.09E+03, 1.19E+03, 1.23E+03, 1.23E+03, 1.23E+03, 1.23E+03, 1.23E+03,
                    1.37E+03, 1.37E+03, 1.37E+03, 1.43E+03, 1.43E+03, 1.49E+03, 1.55E+03, 1.55E+03, 1.55E+03, 1.69E+03,
                    1.69E+03, 1.84E+03, 1.94E+03, 1.97E+03, 2.07E+03, 2.14E+03, 2.14E+03, 2.14E+03, 2.25E+03, 2.25E+03,
                    2.33E+03, 2.47E+03, 2.47E+03, 2.54E+03, 2.62E+03, 2.76E+03, 2.93E+03, 3.00E+03, 3.04E+03, 3.13E+03,
                    3.21E+03, 3.21E+03, 3.21E+03, 3.28E+03, 3.44E+03, 3.59E+03, 3.59E+03, 3.81E+03, 3.82E+03, 3.82E+03]
    FedCS_CNN_T_3 = [801.4810329242405, 1584.1330124984975, 6537.901538417928, 11492.131518850601, 16446.38004477003,
                     17249.489756292493, 19148.492613594528, 19595.295828820224, 21495.023199845593, 23395.23854061865,
                     23798.4095730718, 24263.88253323732, 24723.799651472207, 25509.79127436325, 27411.082193696006,
                     29312.61311302876, 29719.050629500176, 30125.26220617101, 30911.99418574527, 35869.40598276417,
                     40827.05777978306, 42729.90515080843, 44632.869837500584, 46536.07452419274, 51494.90366526728,
                     52136.384433804546, 52925.96199649617, 53715.31361938721, 54123.70555274126, 54914.003115432875,
                     55384.0360755984, 56192.95710852264, 56984.44703777071, 57627.5672541814, 62588.79639525594,
                     64495.003766281305, 65305.55347780376, 66116.77991822675, 66908.77154111779, 71871.20068219233,
                     72683.59213073672, 73476.30375362777, 75383.82562757713, 76196.71352251337, 77009.84141744961,
                     78918.08329139896, 79564.60405993623, 84528.95320101077, 89493.54234208529, 94458.15413910418]
    CNN_T = [ASFL_CNN_T_3,SAFA_CNN_T_3, Oort_CNN_T_3,  FedCS_CNN_T_3]
    # Time SVM
    SAFA_SVM_T_3 = [185.6808995583197, 439.5314597884824, 633.5796627824171, 880.0934017925871, 1107.3729131110722,
                    1365.882657005247, 1636.380611391641, 1869.843735408218, 2141.6336431528794, 2383.540007479534,
                    2661.2555926435502, 2949.729547029944, 3234.1195651664407, 3489.2626891830173, 3780.812707319514,
                    4080.2404477093787, 4379.014465845876, 4684.4719977294, 4978.124706706117, 5287.570724842613,
                    5602.666673531002, 5919.902258695018, 6237.538650815255, 6560.72839470943, 6887.059731481554,
                    7217.5854753757285, 7529.644531163286, 7868.987155232938, 8188.342211020496, 8534.537796184512,
                    8861.03685197207, 9216.490500290654, 9551.02195359374, 9914.299164774015, 10257.660896558113,
                    10626.906804302775, 10999.11762265252, 11376.690833832796, 11752.047225953032, 12136.780437133308,
                    12518.042987983703, 12908.680895728365, 13277.581139154907, 13674.160724318923, 14071.109116439158,
                    14477.498327619434, 14879.1510347003, 15295.315876062663, 15706.624268182899, 16131.366520013582]
    Oort_SVM_T_3 = [197.90617009463116, 363.45108515395543, 578.6944478129694, 772.8005052842329, 886.0494266586501,
                    1114.8174614731784, 1285.601875455922, 1498.3725238196987, 1614.5418243650106, 1826.984176142147,
                    1939.3380259326836, 2064.911559047936, 2234.5432521751864, 2369.864174121637, 2503.8763708031906,
                    2654.4508599618875, 2820.8456070583766, 2972.7247886138302, 3089.2940891591425, 3315.600744642384,
                    3521.919911378739, 3638.609211924051, 3755.4712264706905, 3880.961754272303, 4022.538186997514,
                    4204.113613923259, 4308.744060352683, 4417.765098651418, 4525.697262226416, 4709.601638258801,
                    4843.613448531319, 5049.620881782407, 5154.950901115412, 5373.2485589739545, 5559.467573788339,
                    5734.994685251087, 5943.879988773244, 6143.750649387513, 6286.49934595768, 6372.237236510911,
                    6531.029162906479, 6674.940037602645, 6821.0076026114375, 6983.082437296184, 7157.537546345911,
                    7333.024571281171, 7508.052145612096, 7637.569067878105, 7761.192016230765, 7908.016635346981]
    ASFL_SVM_T_3 = [8.41E+01, 8.45E+01, 8.49E+01, 1.09E+02, 1.09E+02, 1.10E+02, 1.47E+02, 1.49E+02, 1.49E+02, 1.50E+02,
                    1.71E+02, 2.02E+02, 2.30E+02, 2.65E+02, 2.92E+02, 3.22E+02, 3.49E+02, 3.50E+02, 3.50E+02, 3.51E+02,
                    3.52E+02, 3.78E+02, 3.79E+02, 3.80E+02, 3.80E+02, 3.81E+02, 3.82E+02, 3.82E+02, 3.83E+02, 3.84E+02,
                    3.85E+02, 3.86E+02, 3.87E+02, 3.88E+02, 3.88E+02, 4.36E+02, 4.37E+02, 4.37E+02, 4.38E+02, 4.39E+02,
                    4.39E+02, 4.40E+02, 4.41E+02, 4.42E+02, 4.42E+02, 4.79E+02, 4.80E+02, 4.80E+02, 4.82E+02, 4.82E+02]
    FedCS_SVM_T_3 = [3192.715877844102, 5323.410548439833, 7455.637422875841, 10652.341499477707, 13790.878798936896,
                     14667.686821404186, 17868.38397976706, 21069.888056368924, 23307.9225654888, 26511.055037152393,
                     29656.49856457868, 31898.64694831315, 35105.37941997674, 38253.844829177855, 41403.7977434103,
                     44554.950657642745, 47766.104427496146, 50015.452811230614, 52266.00119496509, 54419.304133356745,
                     57576.74766078303, 60794.66353862714, 61504.78918269101, 63663.23611833069, 65920.98450206517,
                     69144.08857866704, 72308.44149289948, 73975.2627388291, 76239.39808828512, 79467.30216488699,
                     82697.19738072935, 84963.8670865366, 86636.37087214876, 88904.91925588324, 89862.03446846365,
                     93036.89987766476, 96273.59703602763, 99450.57799876157, 102629.04340796269, 105808.42437069662,
                     109049.5284472985, 111329.2637967545, 114572.76787335638, 117817.47194995826, 121002.8529126922,
                     124189.7183218933, 127438.02239849517, 130687.52647509705, 132379.2302607092, 134568.87719634888]
    SVM_T = [ASFL_SVM_T_3,SAFA_SVM_T_3, Oort_SVM_T_3,  FedCS_SVM_T_3]
    res_plot2(50, CNN_T, label_list)